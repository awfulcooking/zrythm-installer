#!@BASH@

set -ex

out_dir="`pwd`/$1"
carla_source_zip="$2"
private_dir="$3"
prefix="$4"

carla_git_ver="@CARLA_GIT_VER@"

export CC=@CC@

export PKG_CONFIG_PATH=$prefix/lib/pkgconfig
if pkg-config --atleast-version=2.1 carla-native-plugin ; then
  echo "latest carla installed" ;
fi

pwd
rm -rf $private_dir
mkdir -p $private_dir
unzip -o "$carla_source_zip" -d "$private_dir"
cd "$private_dir/Carla-$carla_git_ver"
make features
make -j4
make install DESTDIR="$out_dir" PREFIX="$prefix" LIBDIR=$prefix/lib
sudo mkdir -p "$prefix"
sudo cp -Rv "$out_dir/$prefix"/* "$prefix"/

ls -l "$out_dir"
